<!DOCTYPE html>
<html lang="en">

  <!-- View -->
  <headReplace metal:use-macro="/templates/header.xhtml/meta_head">
  </headReplace>

  <body>

    <navReplace metal:use-macro="./templates/nav.xhtml/nav_bar">
    </navReplace>
  
<section class="divider_01">
    <div class="container">
        <div class="row">
            <div id="admin_login_box" class="">
                <form id="loginForm">
                <input id="user_name" class="admin_login_input" placeholder="USERNAME" type='text'></input>
            <br/>
                <input id="password" class="admin_login_input" placeholder="PASSWORD" type='password'></input>
                </form>
        <button id="loginbutton" class='admin_login_button'>LOGIN</button>
        <button class='admin_forgot_button'>FORGOT PASSWORD</button>
        <ul id="AJAXMessages"></ul>
            </div>
        </div>
    </div>
</section>


    <footerReplace metal:use-macro="./templates/footer.xhtml/footer_bar">
    </footerReplace>  
      
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="./js/main.js"></script>
      <script>
     $(document).ready(function() {
          /*<![CDATA[*/
            // login event
            $("#loginbutton").click(doLogin);

            // logout event
            //$("#logoutbutton").click(doLogout);
         
            function ConvertFormToJSON(form){
                var array = $(form).serializeArray();
                var json = {};

                jQuery.each(array, function() {
                    // don't send 'undefined'
                    json[this.name] = this.value || '';
                });
                return json;
            }
         
            function doLogin() {

                var formData = ConvertFormToJSON("#loginForm");
                console.log("Login data to send: ", formData);


                $.ajax({
                    url: "login.php",
                    type: "POST",
                    dataType: "JSON",
                    data: formData,
                    success: function(returnedData) {
                        console.log("Login data returned: ", returnedData);

                        var status = returnedData['status'];
                        if(status == 'error') {
                            msgs = returnedData['msg'];
                            for(msg in msgs) {
                                //console.log(msgs[msg]['text']);

                                $("#AJAXMessages").html("<li class='" + msgs[msg]['type']
                                    + "'" + ">" + msgs[msg]['text'] + "</li>");
                            }


                            /* BTW, IF LOGOUT FAILED, IT'S BECAUSE THE SESSION EXPIRED
                               YOU COULD EASILY JUST RESET THE HTML IN THE PAGE
                             */

                        } else {
                            // you're in, show profile
                            /*
                            console.log(returnedData['user']);
                            $("#profileContainer").html("<div id='userProfile'>"
                                + "<h2>User Profile</h2>\n"
                                + "<span>" + returnedData['user']['user_name'] + "</span> "
                                + "<span>" + returnedData['user']['first_name'] + "</span> "
                                + "<span>" + returnedData['user']['last_name'] + "</span>"
                                +"<br/><br/><br/></div>");
                            $("#AJAXMessages").html("");

                            // remove login form
                            $("#loginForm").remove();

                            // create logout form
                            $("#loginFormContainer").after('<div id="logoutFormContainer"><form id="logoutForm"><fieldset><legend>Logout Form</legend><label for="password">Password: </label><input id="logoutbutton" type="button" value="Logout"/><input type="hidden" value="logout" name="logoutButton"/></fieldset></form></div>');
                            $("#logoutbutton").bind("click", doLogout);
*/
                        }


                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log("AJAX Error", textStatus);
                    }
                });
            }
         

         
         /*]]>*/
     });
           </script>
  </body>
</html>
